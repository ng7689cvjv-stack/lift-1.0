<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Lift">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <title>Lift - Workout Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Mono:wght@400;600&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --slate: #f8f6f3;
            --phthalo: #0d3b36;
            --phthalo-dark: #0a2d29;
            --phthalo-light: #115248;
            --text-primary: #2a2d34;
            --text-secondary: #6b7280;
            --grey: #52525b;
            --grey-dark: #3f3f46;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--slate);
            color: var(--text-primary);
            font-family: 'Space Grotesk', sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: calc(80px + env(safe-area-inset-bottom));
            padding-top: env(safe-area-inset-top);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 24px;
        }
        
        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 64px;
            color: var(--text-primary);
            letter-spacing: 2px;
            margin-bottom: 8px;
            line-height: 1;
        }
        
        h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 32px;
            color: var(--phthalo);
            margin-bottom: 24px;
            margin-top: 48px;
            letter-spacing: 1px;
        }
        
        .date-display {
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-secondary);
            font-size: 16px;
            margin-bottom: 32px;
            font-weight: 600;
        }
        
        /* Navigation */
        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            display: flex;
            justify-content: space-around;
            padding: 12px 0 calc(12px + env(safe-area-inset-bottom));
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .nav-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.2s;
        }
        
        .nav-btn.active {
            color: var(--phthalo);
            font-weight: 600;
        }
        
        /* Pages */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* Modern Cards */
        .card {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            border: 1px solid rgba(13, 59, 54, 0.15);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(13, 59, 54, 0.15);
        }
        
        /* Exercise Groups */
        .exercise-groups {
            display: grid;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .exercise-group {
            background: #ffffff;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .exercise-group.expanded {
            border-color: var(--phthalo);
            box-shadow: 0 2px 8px rgba(13, 59, 54, 0.15);
        }
        
        .exercise-group-header {
            padding: 16px 20px;
            background: linear-gradient(90deg, var(--phthalo) 0%, var(--phthalo-dark) 100%);
            color: #ffffff;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .exercise-group-header::after {
            content: '▼';
            font-size: 12px;
            transition: transform 0.3s ease;
        }
        
        .exercise-group.expanded .exercise-group-header::after {
            transform: rotate(180deg);
        }
        
        .exercise-variations {
            padding: 12px;
            display: none;
            flex-direction: column;
            gap: 8px;
        }
        
        .exercise-group.expanded .exercise-variations {
            display: flex;
        }
        
        .variation-btn {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px 16px;
            color: var(--text-primary);
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        
        .variation-btn:hover {
            background: rgba(13, 59, 54, 0.08);
            border-color: var(--phthalo);
        }
        
        .variation-btn.selected {
            background: var(--phthalo);
            border-color: var(--phthalo);
            color: #ffffff;
        }
        
        /* Inputs */
        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
            margin: 24px 0;
        }
        
        .input-wrapper {
            position: relative;
        }
        
        .input-label {
            position: absolute;
            top: -8px;
            left: 12px;
            background: var(--slate);
            padding: 0 8px;
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .input {
            width: 100%;
            padding: 16px;
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 20px;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .input:focus {
            outline: none;
            border-color: var(--phthalo);
            background: rgba(13, 59, 54, 0.03);
            box-shadow: 0 0 0 4px rgba(13, 59, 54, 0.1);
        }
        
        /* Buttons */
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            color: #ffffff;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-grey {
            background: linear-gradient(135deg, var(--grey) 0%, var(--grey-dark) 100%);
            box-shadow: 0 4px 12px rgba(82, 82, 91, 0.25);
        }
        
        .btn-grey:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(82, 82, 91, 0.35);
        }
        
        .btn-phthalo {
            background: linear-gradient(135deg, var(--phthalo) 0%, var(--phthalo-dark) 100%);
            box-shadow: 0 4px 12px rgba(13, 59, 54, 0.25);
        }
        
        .btn-phthalo:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(13, 59, 54, 0.35);
        }
        
        /* Today's Workout */
        #current-workout {
            margin-top: 32px;
            display: none;
        }
        
        .workout-exercise-item {
            position: relative;
            overflow: hidden;
            margin-bottom: 12px;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .workout-exercise-content {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .exercise-info h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }
        
        .exercise-info small {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .exercise-stats {
            font-family: 'IBM Plex Mono', monospace;
            color: var(--phthalo);
            font-size: 16px;
            font-weight: 600;
        }
        
        /* Calendar */
        .calendar {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .calendar-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            color: var(--text-primary);
        }
        
        .calendar-nav {
            display: flex;
            gap: 12px;
        }
        
        .calendar-nav-btn {
            padding: 8px 16px;
            background: var(--phthalo);
            border: none;
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            font-size: 14px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            text-align: center;
        }
        
        .calendar-day-name {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            padding: 8px 0;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
        }
        
        .calendar-day.other-month {
            color: var(--text-secondary);
            opacity: 0.3;
        }
        
        .calendar-day.today {
            border: 2px solid var(--phthalo);
        }
        
        .calendar-day.has-workout {
            background: var(--phthalo);
            color: #ffffff;
        }
        
        /* Workout History */
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .edit-toggle {
            padding: 10px 20px;
            background: transparent;
            border: 2px solid var(--text-secondary);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .edit-toggle:hover {
            border-color: var(--phthalo);
            color: var(--phthalo);
        }
        
        .edit-toggle.active {
            background: var(--phthalo);
            border-color: var(--phthalo);
            color: #ffffff;
        }
        
        .workout-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            border-left: 4px solid var(--phthalo);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .workout-card.edit-mode {
            border-left-color: var(--phthalo-light);
            box-shadow: 0 4px 16px rgba(13, 59, 54, 0.15);
        }
        
        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 16px;
        }
        
        .workout-date {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .workout-volume {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .exercise-row {
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .exercise-row:last-child {
            border-bottom: none;
        }
        
        .exercise-name {
            font-size: 16px;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .exercise-details {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .edit-actions {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
            gap: 8px;
        }
        
        .workout-card.edit-mode .edit-actions {
            display: flex;
        }
        
        .edit-btn {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: 2px solid var(--text-secondary);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .edit-btn:hover {
            border-color: var(--phthalo);
            color: var(--phthalo);
        }
        
        .edit-btn.danger {
            border-color: #dc2626;
            color: #dc2626;
        }
        
        .edit-btn.danger:hover {
            background: #dc2626;
            color: #ffffff;
        }
        
        /* PRs Page */
        .pr-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            border-left: 4px solid var(--phthalo);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .pr-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 12px;
        }
        
        .pr-exercise {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            color: var(--text-primary);
            letter-spacing: 1px;
        }
        
        .pr-date {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .pr-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .pr-stat {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .pr-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .pr-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 24px;
            color: var(--phthalo);
            font-weight: 600;
        }
        
        .pr-variant {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        /* Trends */
        .volume-chart-container {
            background: #ffffff;
            padding: 24px;
            margin-bottom: 32px;
            border-radius: 16px;
            height: 300px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .lift-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            border-left: 4px solid var(--phthalo);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        
        .lift-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(13, 59, 54, 0.15);
        }
        
        .lift-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 20px;
        }
        
        .lift-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 24px;
            color: var(--text-primary);
            letter-spacing: 1px;
        }
        
        .lift-date {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .lift-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .lift-stat {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 24px;
            color: var(--phthalo);
            font-weight: 600;
        }
        
        .stat-variant {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .mini-chart {
            height: 60px;
            background: #f9fafb;
            border-radius: 8px;
        }
        
        /* Settings */
        .settings-section {
            margin-bottom: 32px;
        }
        
        .settings-section h3 {
            font-size: 18px;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        
        .settings-buttons {
            display: grid;
            gap: 12px;
        }
        
        .settings-btn {
            padding: 16px;
            background: #ffffff;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .settings-btn:hover {
            border-color: var(--phthalo);
        }
        
        .settings-info {
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--phthalo);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: var(--text-secondary);
        }
        
        .info-value {
            font-family: 'IBM Plex Mono', monospace;
            color: var(--phthalo);
            font-weight: 600;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- LOG PAGE -->
        <div id="log-page" class="page active">
            <h1>LET'S LIFT</h1>
            <div class="date-display" id="current-date"></div>
            
            <h2>Select Exercise</h2>
            <div class="exercise-groups" id="exercise-groups"></div>
            
            <div class="input-group">
                <div class="input-wrapper">
                    <div class="input-label">Weight</div>
                    <input type="number" id="weight-input" class="input" placeholder="0" step="5">
                </div>
                <div class="input-wrapper">
                    <div class="input-label">Reps</div>
                    <input type="number" id="reps-input" class="input" placeholder="0" step="1">
                </div>
                <div class="input-wrapper">
                    <div class="input-label">Sets</div>
                    <input type="number" id="sets-input" class="input" placeholder="0" step="1" value="3">
                </div>
            </div>
            
            <button class="btn btn-grey" id="add-exercise-btn">Add Exercise</button>
            
            <div id="current-workout">
                <h2>Today's Workout</h2>
                <div id="workout-exercises"></div>
                <button class="btn btn-phthalo" id="finish-workout-btn">Finish Workout</button>
            </div>
        </div>
        
        <!-- CALENDAR PAGE -->
        <div id="calendar-page" class="page">
            <h1>LET'S LIFT</h1>
            <div class="date-display">Calendar & History</div>
            
            <div class="calendar" id="calendar-container"></div>
            
            <div class="history-header">
                <h2 style="margin: 0;">Recent Workouts</h2>
                <button class="edit-toggle" id="edit-toggle">Edit</button>
            </div>
            <div id="workout-history"></div>
        </div>
        
        <!-- PRS PAGE -->
        <div id="prs-page" class="page">
            <h1>LET'S LIFT</h1>
            <div class="date-display">Personal Records</div>
            
            <div id="prs-container"></div>
        </div>
        
        <!-- TRENDS PAGE -->
        <div id="trends-page" class="page">
            <h1>LET'S LIFT</h1>
            <div class="date-display">Progress Analysis</div>
            
            <h2>Weekly Volume</h2>
            <div class="volume-chart-container">
                <canvas id="volume-chart"></canvas>
            </div>
            
            <h2>Lift Progress</h2>
            <div id="lift-cards-container"></div>
        </div>
        
        <!-- SETTINGS PAGE -->
        <div id="settings-page" class="page">
            <h1>LET'S LIFT</h1>
            <div class="date-display">Settings</div>
            
            <div class="settings-section">
                <h3>Data Management</h3>
                <div class="settings-buttons">
                    <button class="settings-btn" id="export-json-btn">Export JSON</button>
                    <button class="settings-btn" id="export-csv-btn">Export CSV</button>
                    <button class="settings-btn" id="import-json-btn">Import JSON</button>
                    <input type="file" id="import-file-input" accept=".json" style="display: none;">
                </div>
            </div>
            
            <div class="settings-section">
                <h3>Workout Stats</h3>
                <div class="settings-info" id="data-info"></div>
            </div>
            
            <div class="settings-section">
                <h3>Danger Zone</h3>
                <button class="settings-btn" id="clear-data-btn" style="border-color: #dc2626; color: #dc2626;">Clear All Data</button>
            </div>
        </div>
    </div>
    
    <!-- Navigation -->
    <div class="nav">
        <button class="nav-btn active" data-page="log">Log</button>
        <button class="nav-btn" data-page="calendar">Calendar</button>
        <button class="nav-btn" data-page="prs">PRs</button>
        <button class="nav-btn" data-page="trends">Trends</button>
        <button class="nav-btn" data-page="settings">Settings</button>
    </div>
    
    <script>
        // Exercise families with variations
        const exerciseFamilies = {
            'Overhead Press': ['Overhead Press', 'Press 2.0', 'Press Jerk', 'Push Press', 'Split Jerk'],
            'Squat': ['Squat', 'Front Squat', 'High Bar Squat', 'Low Bar Squat', 'Pause Squat'],
            'Bench Press': ['Bench Press', 'Close Grip Bench', 'Incline Bench', 'Pause Bench'],
            'Deadlift': ['Deadlift', 'Sumo Deadlift', 'Romanian Deadlift', 'Deficit Deadlift'],
            'Power Clean': ['Power Clean', 'Hang Clean', 'Clean & Jerk', 'Clean Pull']
        };
        
        // Get parent family for any exercise
        function getExerciseFamily(exercise) {
            for (const [family, variations] of Object.entries(exerciseFamilies)) {
                if (variations.includes(exercise)) {
                    return family;
                }
            }
            return exercise; // Return itself if not found
        }
        
        // Storage
        let workouts = JSON.parse(localStorage.getItem('workouts')) || [];
        let todayWorkout = [];
        let selectedExercise = null;
        
        // Initialize
        renderExerciseGroups();
        updateDate();
        renderNav();
        updateDataInfo();
        
        // Current date
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', options);
        }
        
        // Render exercise groups
        function renderExerciseGroups() {
            const container = document.getElementById('exercise-groups');
            container.innerHTML = '';
            
            Object.entries(exerciseFamilies).forEach(([family, variations]) => {
                const group = document.createElement('div');
                group.className = 'exercise-group';
                
                const header = document.createElement('div');
                header.className = 'exercise-group-header';
                header.textContent = family;
                header.onclick = () => group.classList.toggle('expanded');
                
                const variationsContainer = document.createElement('div');
                variationsContainer.className = 'exercise-variations';
                
                variations.forEach(variation => {
                    const btn = document.createElement('button');
                    btn.className = 'variation-btn';
                    btn.textContent = variation;
                    btn.onclick = () => selectExercise(variation, group);
                    variationsContainer.appendChild(btn);
                });
                
                group.appendChild(header);
                group.appendChild(variationsContainer);
                container.appendChild(group);
            });
        }
        
        function selectExercise(exercise, group) {
            // Remove selected from all
            document.querySelectorAll('.variation-btn').forEach(b => b.classList.remove('selected'));
            // Select this one
            event.target.classList.add('selected');
            selectedExercise = exercise;
        }
        
        // Add exercise to today's workout
        document.getElementById('add-exercise-btn').onclick = () => {
            if (!selectedExercise) {
                alert('Please select an exercise first');
                return;
            }
            
            const weight = parseFloat(document.getElementById('weight-input').value);
            const reps = parseInt(document.getElementById('reps-input').value);
            const sets = parseInt(document.getElementById('sets-input').value);
            
            if (!weight || !reps || !sets) {
                alert('Please enter weight, reps, and sets');
                return;
            }
            
            todayWorkout.push({
                exercise: selectedExercise,
                weight,
                reps,
                sets
            });
            
            document.getElementById('current-workout').style.display = 'block';
            renderTodayWorkout();
            
            // Clear inputs
            document.getElementById('weight-input').value = '';
            document.getElementById('reps-input').value = '';
        };
        
        function renderTodayWorkout() {
            const container = document.getElementById('workout-exercises');
            container.innerHTML = '';
            
            todayWorkout.forEach((ex, index) => {
                const item = document.createElement('div');
                item.className = 'workout-exercise-item';
                item.innerHTML = `
                    <div class="workout-exercise-content">
                        <div class="exercise-info">
                            <h4>${ex.exercise}</h4>
                            <small>${getExerciseFamily(ex.exercise)}</small>
                        </div>
                        <div class="exercise-stats">${ex.sets} × ${ex.reps} @ ${ex.weight} lbs</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        // Finish workout
        document.getElementById('finish-workout-btn').onclick = () => {
            if (todayWorkout.length === 0) return;
            
            const now = new Date().toISOString();
            
            todayWorkout.forEach(ex => {
                const sets = [];
                for (let i = 0; i < ex.sets; i++) {
                    sets.push({ weight: ex.weight, reps: ex.reps });
                }
                
                workouts.push({
                    date: now,
                    exercise: ex.exercise,
                    sets: sets
                });
            });
            
            localStorage.setItem('workouts', JSON.stringify(workouts));
            
            todayWorkout = [];
            document.getElementById('current-workout').style.display = 'none';
            
            alert('Workout saved!');
        };
        
        // Calculate 1RM
        function calculate1RM(weight, reps) {
            if (reps === 1) return weight;
            if (reps > 10) return null;
            
            if (reps <= 5) {
                return weight * (1 + reps / 30); // Epley
            } else {
                return weight * (36 / (37 - reps)); // Brzycki
            }
        }
        
        // Navigation
        function renderNav() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.onclick = () => {
                    const page = btn.dataset.page;
                    
                    // Update nav
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Update pages
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    document.getElementById(`${page}-page`).classList.add('active');
                    
                    // Load page content
                    if (page === 'calendar') {
                        renderCalendar();
                        renderWorkoutHistory();
                    } else if (page === 'prs') {
                        renderPRs();
                    } else if (page === 'trends') {
                        renderTrends();
                    } else if (page === 'settings') {
                        updateDataInfo();
                    }
                };
            });
        }
        
        // Calendar
        function renderCalendar() {
            const container = document.getElementById('calendar-container');
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            const workoutDates = new Set();
            workouts.forEach(w => {
                const date = new Date(w.date);
                workoutDates.add(date.toDateString());
            });
            
            let html = `
                <div class="calendar-header">
                    <div class="calendar-title">${firstDay.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</div>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-name">Sun</div>
                    <div class="calendar-day-name">Mon</div>
                    <div class="calendar-day-name">Tue</div>
                    <div class="calendar-day-name">Wed</div>
                    <div class="calendar-day-name">Thu</div>
                    <div class="calendar-day-name">Fri</div>
                    <div class="calendar-day-name">Sat</div>
            `;
            
            // Previous month days
            for (let i = firstDay.getDay() - 1; i >= 0; i--) {
                const day = prevLastDay.getDate() - i;
                html += `<div class="calendar-day other-month">${day}</div>`;
            }
            
            // Current month days
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day);
                const isToday = date.toDateString() === now.toDateString();
                const hasWorkout = workoutDates.has(date.toDateString());
                
                let classes = 'calendar-day';
                if (isToday) classes += ' today';
                if (hasWorkout) classes += ' has-workout';
                
                html += `<div class="${classes}">${day}</div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Workout History
        function renderWorkoutHistory() {
            const container = document.getElementById('workout-history');
            
            if (workouts.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No Workouts Yet</h3><p>Start logging to see your history</p></div>';
                return;
            }
            
            // Group by date, but track original indices
            const workoutsByDate = {};
            workouts.forEach((w, index) => {
                const dateStr = new Date(w.date).toDateString();
                if (!workoutsByDate[dateStr]) {
                    workoutsByDate[dateStr] = [];
                }
                workoutsByDate[dateStr].push({ ...w, originalIndex: index });
            });
            
            const dates = Object.keys(workoutsByDate).sort((a, b) => new Date(b) - new Date(a)).slice(0, 20);
            
            container.innerHTML = dates.map(dateStr => {
                const workoutsOnDay = workoutsByDate[dateStr];
                const totalVolume = workoutsOnDay.reduce((sum, w) => {
                    return sum + w.sets.reduce((s, set) => s + set.weight * set.reps, 0);
                }, 0);
                
                const exerciseRows = workoutsOnDay.map(w => {
                    const setCount = w.sets.length;
                    const repRange = Math.min(...w.sets.map(s => s.reps)) === Math.max(...w.sets.map(s => s.reps)) ?
                        w.sets[0].reps : `${Math.min(...w.sets.map(s => s.reps))}-${Math.max(...w.sets.map(s => s.reps))}`;
                    const weightRange = Math.min(...w.sets.map(s => s.weight)) === Math.max(...w.sets.map(s => s.weight)) ?
                        w.sets[0].weight : `${Math.min(...w.sets.map(s => s.weight))}-${Math.max(...w.sets.map(s => s.weight))}`;
                    
                    return `
                        <div class="exercise-row" data-workout-index="${w.originalIndex}">
                            <div class="exercise-name">${w.exercise}</div>
                            <div class="exercise-details">${setCount} × ${repRange} @ ${weightRange} lbs</div>
                        </div>
                    `;
                }).join('');
                
                // Use first workout's index for date operations
                const firstWorkoutIndex = workoutsOnDay[0].originalIndex;
                
                return `
                    <div class="workout-card" data-date="${dateStr}">
                        <div class="workout-header">
                            <div class="workout-date">${new Date(dateStr).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' })}</div>
                            <div class="workout-volume">${totalVolume.toLocaleString()} lbs</div>
                        </div>
                        <div>${exerciseRows}</div>
                        <div class="edit-actions">
                            <button class="edit-btn" onclick="editWorkoutDate('${dateStr}')">Edit Date</button>
                            <button class="edit-btn" onclick="editWorkoutSets(${firstWorkoutIndex})">Edit Sets</button>
                            <button class="edit-btn danger" onclick="deleteWorkoutDay('${dateStr}')">Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function editWorkoutDate(dateStr) {
            const newDateStr = prompt('Enter new date (MM/DD/YYYY):', new Date(dateStr).toLocaleDateString('en-US'));
            if (!newDateStr) return;
            
            try {
                const newDate = new Date(newDateStr);
                if (isNaN(newDate.getTime())) throw new Error('Invalid date');
                
                // Update all workouts on this day
                workouts.forEach(w => {
                    if (new Date(w.date).toDateString() === dateStr) {
                        w.date = newDate.toISOString();
                    }
                });
                
                localStorage.setItem('workouts', JSON.stringify(workouts));
                renderWorkoutHistory();
                renderCalendar();
                alert('Date updated!');
            } catch (err) {
                alert('Invalid date format. Please use MM/DD/YYYY');
            }
        }
        
        function editWorkoutSets(workoutIndex) {
            const workout = workouts[workoutIndex];
            if (!workout) return;
            
            const currentSets = workout.sets.map((s, i) => 
                `Set ${i + 1}: ${s.weight} lbs × ${s.reps} reps`
            ).join('\n');
            
            const newSetsStr = prompt(
                `Edit sets for ${workout.exercise}\n\nCurrent sets:\n${currentSets}\n\nEnter new sets (one per line, format: weight x reps):\nExample: 225 x 5`,
                workout.sets.map(s => `${s.weight} x ${s.reps}`).join('\n')
            );
            
            if (!newSetsStr) return;
            
            try {
                const newSets = newSetsStr.trim().split('\n').map(line => {
                    const match = line.match(/(\d+\.?\d*)\s*x\s*(\d+)/i);
                    if (!match) throw new Error('Invalid format');
                    return {
                        weight: parseFloat(match[1]),
                        reps: parseInt(match[2])
                    };
                });
                
                if (newSets.length === 0) throw new Error('No sets entered');
                
                workout.sets = newSets;
                localStorage.setItem('workouts', JSON.stringify(workouts));
                renderWorkoutHistory();
                alert('Sets updated!');
            } catch (err) {
                alert('Invalid format. Use: weight x reps (e.g., 225 x 5)');
            }
        }
        
        function deleteWorkoutDay(dateStr) {
            const workoutsOnDay = workouts.filter(w => new Date(w.date).toDateString() === dateStr);
            const exerciseList = workoutsOnDay.map(w => w.exercise).join(', ');
            
            if (!confirm(`Delete all workouts from ${new Date(dateStr).toLocaleDateString()}?\n\nExercises: ${exerciseList}\n\nThis cannot be undone.`)) {
                return;
            }
            
            // Remove all workouts from this day
            workouts = workouts.filter(w => new Date(w.date).toDateString() !== dateStr);
            localStorage.setItem('workouts', JSON.stringify(workouts));
            renderWorkoutHistory();
            renderCalendar();
            alert('Workouts deleted!');
        }
        
        // Edit toggle
        document.getElementById('edit-toggle').onclick = function() {
            this.classList.toggle('active');
            const isActive = this.classList.contains('active');
            
            document.querySelectorAll('.workout-card').forEach(card => {
                if (isActive) {
                    card.classList.add('edit-mode');
                } else {
                    card.classList.remove('edit-mode');
                }
            });
        };
        
        // PRs
        function renderPRs() {
            const container = document.getElementById('prs-container');
            
            if (workouts.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No PRs Yet</h3><p>Start lifting to see your records</p></div>';
                return;
            }
            
            const mainFamilies = Object.keys(exerciseFamilies);
            const prs = {};
            
            mainFamilies.forEach(family => {
                let bestE1RM = 0;
                let bestWeight = 0;
                let bestReps = 0;
                let bestDate = null;
                let bestVariation = null;
                
                workouts.forEach(w => {
                    if (getExerciseFamily(w.exercise) === family) {
                        w.sets.forEach(set => {
                            const e1rm = calculate1RM(set.weight, set.reps);
                            if (e1rm && e1rm > bestE1RM) {
                                bestE1RM = e1rm;
                                bestWeight = set.weight;
                                bestReps = set.reps;
                                bestDate = w.date;
                                bestVariation = w.exercise;
                            }
                        });
                    }
                });
                
                if (bestE1RM > 0) {
                    prs[family] = {
                        e1rm: Math.round(bestE1RM),
                        weight: bestWeight,
                        reps: bestReps,
                        date: bestDate,
                        variation: bestVariation
                    };
                }
            });
            
            container.innerHTML = mainFamilies.map(family => {
                const pr = prs[family];
                if (!pr) {
                    return `
                        <div class="pr-card">
                            <div class="pr-header">
                                <div class="pr-exercise">${family}</div>
                                <div class="pr-date">No data</div>
                            </div>
                            <div class="pr-stats">
                                <div class="pr-stat">
                                    <div class="pr-label">Current PR</div>
                                    <div class="pr-value">—</div>
                                </div>
                                <div class="pr-stat">
                                    <div class="pr-label">Est. 1RM</div>
                                    <div class="pr-value">—</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                return `
                    <div class="pr-card">
                        <div class="pr-header">
                            <div class="pr-exercise">${family}</div>
                            <div class="pr-date">${new Date(pr.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</div>
                        </div>
                        <div class="pr-stats">
                            <div class="pr-stat">
                                <div class="pr-label">Current PR</div>
                                <div class="pr-value">${pr.weight} × ${pr.reps}</div>
                                <div class="pr-variant">${pr.variation}</div>
                            </div>
                            <div class="pr-stat">
                                <div class="pr-label">Est. 1RM</div>
                                <div class="pr-value">${pr.e1rm} lbs</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Trends
        let volumeChart = null;
        
        function renderTrends() {
            if (typeof Chart === 'undefined') {
                setTimeout(renderTrends, 200);
                return;
            }
            renderWeeklyVolume();
            renderLiftCards();
        }
        
        function renderWeeklyVolume() {
            const canvas = document.getElementById('volume-chart');
            if (!canvas) return;
            
            if (workouts.length === 0) {
                canvas.parentElement.innerHTML = '<div class="empty-state"><h3>No Data Yet</h3><p>Start logging workouts to see volume trends</p></div>';
                return;
            }
            
            if (volumeChart) {
                volumeChart.destroy();
                volumeChart = null;
            }
            
            // Group by week
            const weeklyData = {};
            const now = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const weekStart = new Date(now);
                weekStart.setDate(now.getDate() - now.getDay() - (i * 7));
                weekStart.setHours(0, 0, 0, 0);
                const weekKey = weekStart.toISOString().split('T')[0];
                weeklyData[weekKey] = 0;
            }
            
            workouts.forEach(w => {
                const date = new Date(w.date);
                const weekStart = new Date(date);
                weekStart.setDate(date.getDate() - date.getDay());
                weekStart.setHours(0, 0, 0, 0);
                const weekKey = weekStart.toISOString().split('T')[0];
                
                if (weeklyData.hasOwnProperty(weekKey)) {
                    w.sets.forEach(set => {
                        weeklyData[weekKey] += set.weight * set.reps;
                    });
                }
            });
            
            const weeks = Object.keys(weeklyData).sort();
            const volumes = weeks.map(week => weeklyData[week]);
            
            const labels = weeks.map(weekStart => {
                const start = new Date(weekStart);
                const end = new Date(start);
                end.setDate(start.getDate() + 6);
                
                const formatDate = (d) => {
                    const month = d.toLocaleDateString('en-US', { month: 'short' });
                    const day = d.getDate();
                    return `${month} ${day}`;
                };
                
                return `${formatDate(start)} - ${formatDate(end)}`;
            });
            
            const ctx = canvas.getContext('2d');
            
            volumeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Volume (lbs)',
                        data: volumes,
                        backgroundColor: '#0d3b36',
                        borderColor: '#0d3b36',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                color: '#6b7280',
                                font: { family: 'IBM Plex Mono', size: 12 }
                            },
                            grid: { color: '#e5e7eb' }
                        },
                        x: {
                            ticks: { 
                                color: '#6b7280',
                                font: { family: 'IBM Plex Mono', size: 11 }
                            },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }
        
        function renderLiftCards() {
            const container = document.getElementById('lift-cards-container');
            const mainFamilies = Object.keys(exerciseFamilies);
            
            if (workouts.length === 0) {
                container.innerHTML = '<div class="empty-state"><h3>No Lifts Yet</h3><p>Start logging to see progress</p></div>';
                return;
            }
            
            const liftData = {};
            
            mainFamilies.forEach(family => {
                const familyWorkouts = workouts
                    .filter(w => getExerciseFamily(w.exercise) === family)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));
                
                if (familyWorkouts.length === 0) return;
                
                let bestE1RM = 0;
                let bestWeight = 0;
                let bestReps = 0;
                let bestDate = null;
                let bestVariation = null;
                const e1rmHistory = [];
                
                familyWorkouts.forEach(workout => {
                    let maxE1RMThisWorkout = 0;
                    
                    workout.sets.forEach(set => {
                        const e1rm = calculate1RM(set.weight, set.reps);
                        if (e1rm && e1rm > bestE1RM) {
                            bestE1RM = e1rm;
                            bestWeight = set.weight;
                            bestReps = set.reps;
                            bestDate = workout.date;
                            bestVariation = workout.exercise;
                        }
                        if (e1rm && e1rm > maxE1RMThisWorkout) {
                            maxE1RMThisWorkout = e1rm;
                        }
                    });
                    
                    if (maxE1RMThisWorkout > 0) {
                        e1rmHistory.push(Math.round(maxE1RMThisWorkout));
                    }
                });
                
                if (bestE1RM > 0) {
                    liftData[family] = {
                        e1rm: Math.round(bestE1RM),
                        weight: bestWeight,
                        reps: bestReps,
                        date: bestDate,
                        variation: bestVariation,
                        history: e1rmHistory.slice(-8)
                    };
                }
            });
            
            container.innerHTML = mainFamilies.map(family => {
                const data = liftData[family];
                
                if (!data) {
                    return `
                        <div class="lift-card">
                            <div class="lift-header">
                                <div class="lift-title">${family}</div>
                                <div class="lift-date">No data</div>
                            </div>
                            <div class="lift-stats">
                                <div class="lift-stat">
                                    <div class="stat-label">Current PR</div>
                                    <div class="stat-value">—</div>
                                </div>
                                <div class="lift-stat">
                                    <div class="stat-label">Est. 1RM</div>
                                    <div class="stat-value">—</div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                const chartId = `chart-${family.replace(/\s+/g, '-').toLowerCase()}`;
                
                setTimeout(() => {
                    const canvas = document.getElementById(chartId);
                    if (!canvas) return;
                    
                    new Chart(canvas, {
                        type: 'line',
                        data: {
                            labels: data.history.map((_, i) => ''),
                            datasets: [{
                                data: data.history,
                                borderColor: '#115248',
                                backgroundColor: 'rgba(17, 82, 72, 0.1)',
                                borderWidth: 2,
                                tension: 0.4,
                                fill: true,
                                pointRadius: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { display: false },
                                x: { display: false }
                            },
                            plugins: {
                                legend: { display: false },
                                tooltip: { enabled: false }
                            }
                        }
                    });
                }, 100);
                
                return `
                    <div class="lift-card">
                        <div class="lift-header">
                            <div class="lift-title">${family}</div>
                            <div class="lift-date">${new Date(data.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</div>
                        </div>
                        <div class="lift-stats">
                            <div class="lift-stat">
                                <div class="stat-label">Current PR</div>
                                <div class="stat-value">${data.weight} × ${data.reps}</div>
                                <div class="stat-variant">${data.variation}</div>
                            </div>
                            <div class="lift-stat">
                                <div class="stat-label">Est. 1RM</div>
                                <div class="stat-value">${data.e1rm} lbs</div>
                            </div>
                        </div>
                        <div class="mini-chart">
                            <canvas id="${chartId}"></canvas>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Settings
        function updateDataInfo() {
            const totalWorkouts = workouts.length;
            const totalSets = workouts.reduce((sum, w) => sum + w.sets.length, 0);
            const totalVolume = workouts.reduce((sum, w) => {
                return sum + w.sets.reduce((s, set) => s + set.weight * set.reps, 0);
            }, 0);
            
            document.getElementById('data-info').innerHTML = `
                <div class="info-row">
                    <span class="info-label">Total Workouts</span>
                    <span class="info-value">${totalWorkouts}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Total Sets</span>
                    <span class="info-value">${totalSets}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Total Volume</span>
                    <span class="info-value">${totalVolume.toLocaleString()} lbs</span>
                </div>
            `;
        }
        
        // Export JSON
        document.getElementById('export-json-btn').onclick = () => {
            const data = {
                workouts,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `workout-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        };
        
        // Export CSV
        document.getElementById('export-csv-btn').onclick = () => {
            let csv = 'Date,Exercise,Set,Weight,Reps,Volume\n';
            
            workouts.forEach(w => {
                w.sets.forEach((set, i) => {
                    const date = new Date(w.date).toLocaleDateString();
                    const volume = set.weight * set.reps;
                    csv += `${date},${w.exercise},${i + 1},${set.weight},${set.reps},${volume}\n`;
                });
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `workout-data-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        };
        
        // Import JSON
        document.getElementById('import-json-btn').onclick = () => {
            document.getElementById('import-file-input').click();
        };
        
        document.getElementById('import-file-input').onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    workouts = data.workouts || [];
                    localStorage.setItem('workouts', JSON.stringify(workouts));
                    alert('Data imported successfully!');
                    updateDataInfo();
                } catch (err) {
                    alert('Error importing data: ' + err.message);
                }
            };
            reader.readAsText(file);
        };
        
        // Clear data
        document.getElementById('clear-data-btn').onclick = () => {
            if (!confirm('Are you sure? This cannot be undone.')) return;
            if (!confirm('Really delete ALL workout data? This is permanent!')) return;
            
            workouts = [];
            localStorage.setItem('workouts', JSON.stringify(workouts));
            alert('All data cleared');
            updateDataInfo();
        };
        
        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW error:', err));
            });
        }
    </script>
</body>
</html>
